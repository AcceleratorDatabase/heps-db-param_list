<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Parameter Data</title>
    </h:head>
    <h:body>
        <h:form id="paraForm">
            <p:dataTable id="datas" var="data" value="#{dataMB.dataDispList}" widgetVar="dt"  rowKey="#{data.id}" editable="#{dataMB.isLogin==true}" editMode="cell"    paginator="true" rows="20" sortMode="multiple" >
                <f:facet name="header">
                    <h:outputText value=" List of Parameter Values" style="font-size: 24px;color:royalblue"/>                                  
                </f:facet>    
                <f:facet name="header">
                    <p:commandButton id="toggler" type="button" value="Choose Columns to View" style="float:left;color: blueviolet" icon="ui-icon-calculator" />
                    <p:commandButton value="Add a Record"  style="float:left;color:blueviolet" oncomplete="PF('addDialog').show()"   disabled= "#{dataMB.isLogin==false}"/>
                    <p:commandButton   value="Login" style="float:left;color: blueviolet" oncomplete="PF('logDialog').show()"/>
                    <p:columnToggler datasource="datas" trigger="toggler">
                        <p:ajax event="toggle" listener="#{dataMB.onToggle}"/>                 			 
                    </p:columnToggler>   
                </f:facet>
                <p:ajax event="cellEdit" listener="#{dataMB.cellEdit}" update=":paraForm:datas"/>   

                <p:column style="width:10px">
                    <p:rowToggler> 
                    </p:rowToggler>      
                </p:column>

                <p:column visible="#{dataMB.stateList[0]}" >
                    <f:facet name="header">
                        <h:outputText value="Id"/>
                    </f:facet>
                    <h:outputText value="#{data.id}" />        
                </p:column>
                <p:column sortBy="#{data.system}" filterBy="#{data.system}" filterMatchMode="contains"  visible="#{dataMB.stateList[1]}">
                    <f:facet name="header">
                        <h:outputText value="System"/>
                    </f:facet>
                    <h:outputText value="#{data.system}"/>
                </p:column>
                <p:column  sortBy="#{data.subsystem}" filterBy="#{data.subsystem}"  filterMatchMode="contains" visible="#{dataMB.stateList[2]}">
                    <f:facet name="header">
                        <h:outputText value="Subsystem"/>
                    </f:facet>
                    <h:outputText value="#{data.subsystem}"/>
                </p:column>
                <p:column filterBy="#{data.device}"  filterMatchMode="contains" visible="#{dataMB.stateList[3]}">
                    <f:facet name="header">
                        <h:outputText value="Device Type"/>
                    </f:facet>
                    <h:outputText value="#{data.device}"/>
                </p:column>
                <p:column visible="#{dataMB.stateList[4]}">
                    <f:facet name="header">
                        <h:outputText value="Parameter Name"/>
                    </f:facet>
                    <h:outputText value="#{data.parameterName}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[5]}">
                    <f:facet name="header">
                        <h:outputText value="Attribute"/>
                    </f:facet>
                    <h:outputText value="#{data.attibute}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[6]}">
                    <f:facet name="header">
                        <h:outputText value="Unit"/>
                    </f:facet>
                    <h:outputText value="#{data.unit}"/>               
                </p:column>

                <p:column visible="#{dataMB.stateList[7]}">

                    <f:facet name="header">
                        <h:outputText value="Value"/>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText  value="#{data.value}"/>  
                        </f:facet>
                        <f:facet  name="input">
                            <h:inputText  value="#{data.value}" style="color:red" />  
                        </f:facet>
                    </p:cellEditor> 
                </p:column>
                <p:column visible="#{dataMB.stateList[8]}">
                    <f:facet name="header">
                        <h:outputText value="Change Date"/>
                    </f:facet>
                    <h:outputText value="#{data.changeDate}"> 
                        <f:convertDateTime timeZone="GMT+8" pattern="yyyy/MM/dd" locale="zh"/>
                    </h:outputText>
                </p:column>
                <p:column visible="#{dataMB.stateList[9]}">
                    <f:facet name="header">
                        <h:outputText value="Definition"/>
                    </f:facet>
                    <h:outputText value="#{data.definition}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[10]}">
                    <f:facet name="header">
                        <h:outputText value="Reference Title"/>
                    </f:facet>
                    <h:outputText value="#{data.referenceTitle}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[11]}">
                    <f:facet name="header">
                        <h:outputText value="Reference Author"/>
                    </f:facet>
                    <h:outputText value="#{data.referenceAuthor}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[12]}">
                    <f:facet name="header">
                        <h:outputText value="Reference Publication"/>
                    </f:facet>
                    <h:outputText value="#{data.referencePublication}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[13]}">
                    <f:facet name="header">
                        <h:outputText value="Reference URL"/>
                    </f:facet>
                    <h:outputText value="#{data.referenceURL}"/>               
                </p:column>
                <p:column visible="#{dataMB.stateList[14]}">
                    <f:facet name="header">
                        <h:outputText value="Keyword"/>
                    </f:facet>
                    <h:outputText value="#{data.keyword}"/>               
                </p:column>

                <p:column headerText="" visible="#{dataMB.isLogin==true}">
                    <p:commandButton value="Delete">
                        <p:ajax event="click" listener="#{dataMB.setSelect(data)}" oncomplete="PF('delDialog').show()" /> 
                    </p:commandButton>
                </p:column>

                <p:rowExpansion id="expandedText">
                    <p:dataTable id="historyValueDatas"  var="historyData" value="#{data.data.historyDataList}" style="width:400px"  paginator="true" rows="10">

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Modified Value"/>
                            </f:facet>
                            <h:outputText value="#{historyData.value}"/>               
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Modified Date"/>
                            </f:facet>
                            <h:outputText value="#{historyData.dateModified}"> 
                                <f:convertDateTime timeZone="GMT+8" pattern="yyyy/MM/dd" locale="zh"/>
                            </h:outputText>
                        </p:column>



                    </p:dataTable>
                </p:rowExpansion>                
            </p:dataTable>
        </h:form>

        <p:dialog header="Add a New Record" widgetVar="addDialog" modal="true">
            <h:form id="addForm">
                <h:panelGrid columns="4" cellpadding="10" id="addPanel">
                    <p:outputLabel value="System:" />
                    <p:selectOneMenu value="#{dataMB.select.system}">                          
                        <f:selectItem itemLabel="Select One" itemValue="" />    
                        <p:ajax  listener="#{dataMB.systemSelect}" process="@this" />     
                        <f:selectItems  value="#{systemMB.systemList}" var="systemList" itemLabel="#{systemList.name}" itemValue="#{systemList.name}"/>                                           
                    </p:selectOneMenu>

                    <p:outputLabel value="Subsystem:"  />
                    <p:selectOneMenu value="#{dataMB.select.subsystem}">                          
                        <f:selectItem itemLabel="Select One" itemValue=""/> 
                        <p:ajax  listener="#{dataMB.subsystemSelect}" process="@this" />  
                        <f:selectItems  value="#{subsystemMB.subsystemList}" var="subsystemList" itemLabel="#{subsystemList.name}" itemValue="#{subsystemList.name}"/>                                           
                    </p:selectOneMenu>

                    <p:outputLabel value="Device Type:"  />
                    <p:selectOneMenu value="#{dataMB.select.device}">                          
                        <f:selectItem itemLabel="Select One" itemValue="" /> 
                        <p:ajax  listener="#{dataMB.devicetypeSelect}" process="@this" />  
                        <f:selectItems  value="#{devicetypeMB.devicetypeList}" var="devicetypeList" itemLabel="#{devicetypeList.name}" itemValue="#{devicetypeList.name}"/>                                           
                    </p:selectOneMenu>

                    <p:outputLabel value="Parameter:"  />
                    <p:selectOneMenu id="parameters" value="#{dataMB.selectedParameter.id}">     
                        <f:selectItem itemLabel="Select One" itemValue="" />        
                        <p:ajax  listener="#{dataMB.parameterSelect}" process="@this" update="unit4parameter,def4parameter,ref4parameter"/>                       
                        <f:selectItems  value="#{parameterMB.parameterList}" var="parameterList" itemLabel="#{parameterList.name}" itemValue="#{parameterList.id}"/>                                                                   
                    </p:selectOneMenu>

                    <p:outputLabel value="Attribute:"   />
                    <p:selectOneMenu  value="#{dataMB.select.attibute}">                          
                        <f:selectItem itemLabel="Select One" itemValue="" />   
                        <p:ajax  listener="#{dataMB.attributeSelect}" process="@this" />  
                        <f:selectItems  value="#{attributeMB.attributeList}" var="attributeList" itemLabel="#{attributeList.name}" itemValue="#{attributeList.name}"/>                                           
                    </p:selectOneMenu>

                    <p:outputLabel value="Team:" />
                    <p:selectOneMenu value="#{dataMB.select.team}">                          
                        <f:selectItem itemLabel="Select One" itemValue="" />    
                        <p:ajax  listener="#{dataMB.teamSelect}" process="@this" />     
                        <f:selectItems  value="#{teamMB.teamList}" var="teamList" itemLabel="#{teamList.name}" itemValue="#{teamList.name}"/>                                           
                    </p:selectOneMenu>

                    <p:outputLabel value="Unit:"  />
                    <h:outputText id="unit4parameter" value="#{dataMB.selectedParameter.unitid.name}"/>

                    <p:outputLabel value="Definition:"  />
                    <h:outputText id="def4parameter" value="#{dataMB.selectedParameter.definition}"/>

                    <p:outputLabel value="Reference:"  />
                    <h:outputText id="ref4parameter" value="#{dataMB.selectedParameter.referenceid.title}"/>

                    <p:outputLabel value="Value:" />
                    <p:inputText value="#{dataMB.select.value}" />

                    <p:commandButton value="commit" oncomplete="PF('addDialog').hide()" actionListener="#{dataMB.add}" update=":paraForm:datas"/>
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="Are you sure to delete the record?" widgetVar="delDialog" modal="true">
            <h:form id="delForm">
                <p:messages  id="delMsg" autoUpdate="true"/>
                <h:panelGrid columns="2" cellpadding="10" id="delPanel">
                    <f:facet name="delFacet">
                        <p:outputLabel value="Are you sure?"/>
                    </f:facet>
                    <p:commandButton value="YES" actionListener="#{dataMB.delete}" update=":paraForm:datas,delForm"  styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                    <p:commandButton value="NO" type="button" onclick="PF('delDialog').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close"  />
                    
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="Leader Login" widgetVar="logDialog" modal="true">
            <h:form id="logForm">
                <p:messages id="msgs" autoUpdate="true"/>

                <h:panelGrid columns="2" cellpadding="10" id="loglPanel">
                    <p:outputLabel value="Name:"  />
                    <h:inputText  value="#{dataMB.manager.name}"/>                   
                    <p:outputLabel value="Password:" />
                    <p:password value="#{dataMB.manager.password}" />                 
                    <p:commandButton value="commit" actionListener="#{dataMB.validate}" update=":paraForm:datas,logForm"  />                                
                    <p:commandButton value="close" onclick="PF('logDialog').hide()"/>
                </h:panelGrid>
            </h:form>
        </p:dialog>

    </h:body>
</html>

